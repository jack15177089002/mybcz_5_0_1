function ObjectCreator(){}ObjectCreator.prototype.createProblem=function(){return new Problem()};ObjectCreator.prototype.createProblems=function(c){if(c<=0){return null}var a=[];for(var b=0;b<c;b++){var d=new Problem();a.push(d)}return a};function TypeStrategy(a){if(!a){throw new Error("interface cannot be initialized!")}}TypeStrategy.prototype={getType:function(a){}};function Type(a){this.value=a}Type.NULL=new Type(0);Type.SENTENCE_TO_PIC=new Type(1);Type.WORD_TO_PIC=new Type(2);Type.PIC_TO_CHINESE=new Type(3);function BasicTypeStrategy(){}BasicTypeStrategy.prototype=new TypeStrategy(true);BasicTypeStrategy.prototype.getType=function(a){if(!a){return null}if(a.score<0){return Type.SENTENCE_TO_PIC}else{if(a.score==2){return Type.PIC_TO_CHINESE}}return Type.WORD_TO_PIC};function MultiMediaTypeStrategy(){}MultiMediaTypeStrategy.prototype=new TypeStrategy(true);MultiMediaTypeStrategy.prototype.getType=function(a){return Type.NULL};var Constants={};Constants.MAX_INT=2147483647;Constants.NEW_LEARNING_SCORE=-1024;Constants.KILLED_SCORE=-1;Constants.CANCEL_KILL_SCORE=5;Constants.DEFAULT_KILLED_SCORE=-1;Constants.MIN_KILLED_SCORE=-9;Constants.DEFAULT_CANCEL_KILL_SCORE=5;function LinkedList(){this._init()}LinkedList.prototype._init=function(){this._listSize=0;this._head=new LinkedList.Node();this._tail=new LinkedList.Node();this._head.next=this._tail;this._tail.previous=this._head;this._id=0};LinkedList.prototype.iterator=function(){return new LinkedList.Iterator(this)};LinkedList.prototype.size=function(){return this._listSize};LinkedList.prototype.add=function(a){var b=new LinkedList.Node(a);var c=this._tail.previous;c.next=b;b.previous=c;b.next=this._tail;this._tail.previous=b;this._listSize++};LinkedList.prototype.getLast=function(){var a=this._tail.previous;if(a==this._head){return null}return a};LinkedList.prototype.isEmpty=function(){return this._listSize==0};LinkedList.prototype.indexOf=function(b){var a=0;for(var c=this._head.next;c!=this._tail;c=c.next,a++){if(this._equals(b,c.element)){return a}}return -1};LinkedList.prototype.remove=function(a){for(var b=this._head.next;b!=this._tail;b=b.next){if(this._equals(a,b.element)){b.previous.next=b.next;b.next.previous=b.previous;this._listSize--;return}}};LinkedList.prototype.insert=function(e,b){if(e>this._listSize){return}var a=0;for(var d=this._head.next;d!=null;d=d.next,a++){if(a<e){continue}var c=new LinkedList.Node(b);d.previous.next=c;c.previous=d.previous;d.previous=c;c.next=d;this._listSize++;return}};LinkedList.prototype._print=function(b){var a="LinkedList(id:"+this._id+")(act:"+b+")[";for(var c=this._head.next;c!=this._tail;c=c.next){a+=c.element.id+","}a+="]";Log.info(a)};LinkedList.prototype.insertAfter=function(d,a){for(var c=this._head.next;c!=this._tail;c=c.next){if(this._equals(d,c.element)){var b=new LinkedList.Node(a);c.previous.next=b;b.previous=c.previous;c.previous=b;b.next=c;this._listSize++;return}}};LinkedList.prototype._equals=function(c,b){if(c==b){return true}var a=c;if(a&&typeof(a)=="object"&&a.equals&&typeof(a.equals)=="function"){if(a.equals(b)){return true}}return false};LinkedList.Node=function(a){this.previous=null;this.element=a;this.next=null};LinkedList.Iterator=function(a){this._list=a;this._it=a._head.next};LinkedList.Iterator.prototype.next=function(){if(!this.hasNext()){return null}var a=this._it;this._it=this._it.next;return a.element};LinkedList.Iterator.prototype.hasNext=function(){return(this._it!=null&&this._it!=this._list._tail)};function LearningManager(){this.sequenceMode=null;this.typeMode=null;this._inited=false}LearningManager.prototype={init:function(c,b,a){this._roadMap=c;this._doneProblems=b;this._todayDoneProblems=a;this._bucketMananger=new BucketManager(c,b);this._bucketMananger.build();this.SEQUENCE_MODE={};this.TYPE_MODE={LEARNING:{id:1,strategy:new BasicTypeStrategy()},MULTI_MEDIA:{id:2,strategy:new MultiMediaTypeStrategy()}};this._inited=true},initWithBuckets:function(d,b,c,a){this._roadMap=d;this._doneProblems=b;this._todayDoneProblems=a;this._bucketMananger=new BucketManager(d,b);this._bucketMananger.buildWithBuckets(c);this.SEQUENCE_MODE={};this.TYPE_MODE={LEARNING:{id:1,strategy:new BasicTypeStrategy()},MULTI_MEDIA:{id:2,strategy:new MultiMediaTypeStrategy()}};this._inited=true},setSequenceModeNewAndReview:function(c,b){var a=0;if(b!=null&&typeof(b)=="object"){a=b.slideWindowSize}var d=new NewAndReviewSequenceStrategy(this._bucketMananger,c,this._roadMap,this._doneProblems,this._todayDoneProblems);d.setSlideWindowSize(a);d.setTodayDoneProblems(this._todayDoneProblems);this.SEQUENCE_MODE.NEW_AND_REVIEW={id:1,strategy:d};this._setSequenceMode(this.SEQUENCE_MODE.NEW_AND_REVIEW)},setSequenceModeReviewMore:function(c,b){var a=0;if(b!=null&&typeof(b)=="object"){a=b.slideWindowSize}var d=new ReviewMoreSequenceStrategy(this._bucketMananger,c,this._roadMap,this._doneProblems);d.setSlideWindowSize(a);d.setTodayDoneProblems(this._todayDoneProblems);this.SEQUENCE_MODE.REVIEW_MORE={id:2,strategy:d};this._setSequenceMode(this.SEQUENCE_MODE.REVIEW_MORE)},setSequenceModeMultiMedia:function(e,c){var a=0;var d=null;var b=null;if(c!=null&&typeof(c)=="object"){a=c.slideWindowSize;d=c.learnedList;b=c.skippedList}var f=new MultiMediaSequenceStrategy(this._bucketMananger,e,this._roadMap,this._doneProblems,d,b);f.setSlideWindowSize(a);f.setTodayDoneProblems(this._todayDoneProblems);this.SEQUENCE_MODE.MULTI_MEDIA={id:4,strategy:f};this._setSequenceMode(this.SEQUENCE_MODE.MULTI_MEDIA)},setTypeModeLearning:function(a){this._setTypeMode(this.TYPE_MODE.LEARNING)},setTypeModeMultiMedia:function(a){this._setTypeMode(this.TYPE_MODE.MULTI_MEDIA)},getSequenceStrategy:function(){if(this.sequenceMode){return this.sequenceMode.strategy}return null},getTypeStrategy:function(){if(this.typeMode){return this.typeMode.strategy}return null},isInited:function(){return this._inited},_setSequenceMode:function(a){this.sequenceMode=a},_setTypeMode:function(a){this.typeMode=a}};function Bucket(a,b){if(!a){throw new Error("abstract class cannot be initialized!")}this._name=b}Bucket.prototype={next:function(a){},nextOne:function(){var a=this.next(1);if(a==null||!a.length){return null}if(a.length>0){return a[0]}return null},hasNext:function(){},size:function(){},rewind:function(){},remove:function(a){},add:function(a){},getName:function(){return this._name}};function SequenceStrategy(a){if(!a){throw new Error("interface cannot be initialized!")}}SequenceStrategy.prototype={getTodayRoadMap:function(){},userActionHint:function(a){},getReviewCount:function(){},getNewLearningCount:function(){},getNewLearningAndReviewCount:function(){},getNext:function(b,a){},getNextOne:function(){var a=this.getNext(0,1);if(!a||!a.length||a.length<=0){return null}return a[0]},hasNext:function(){},doneCorrect:function(c,b,a){},doneWrong:function(c,b,a){},kill:function(a){},cancelKill:function(a){},skip:function(a){},cancelSkip:function(a){}};Log={};Log._get=function(){var a=null;try{a=console}catch(c){try{a=com.baicizhan.learning_strategy.util.L.log}catch(b){}}return a};Log._log=function(e,c){var b=Log._get();if(!b){return}if(!c||!c.length){return}for(var d=0;d<c.length;d++){var a=c[d];if(b[a]){b[a](e);return}}};Log.debug=function(a){Log._log(a,["debug","log"])};Log.info=function(a){Log._log(a,["info","log"])};function Problem(){}Problem.prototype={id:0,word:null,score:0,wrongCount:0,reviewMoreCount:0,lastScore:0,lastLearnedTime:0,todayNewLearned:false,deepLearning:false,actionHintCount:0,actionHintReviewedCount:0};Problem.prototype.equals=function(a){if(a==null||typeof(a)!="object"||a.id==null){return false}return this.id==a.id};Problem.prototype.isKilled=function(){return this.score<0&&this.score!=Constants.NEW_LEARNING_SCORE};Problem.prototype.kill=function(){var a=this.score;if(a>0){this.score=-a}else{if(a==0){this.score=Constants.DEFAULT_KILLED_SCORE}else{if(a==Constants.NEW_LEARNING_SCORE){this.score=Constants.DEFAULT_KILLED_SCORE}}}if(this.score<Constants.MIN_KILLED_SCORE){this.score=Constants.MIN_KILLED_SCORE}};Problem.prototype.cancelKill=function(){var a=this.score;if(a<=-1&&a>=-4){this.score=Constants.DEFAULT_CANCEL_KILL_SCORE}else{if(a<0){this.score=-a}}if(this.score>-Constants.MIN_KILLED_SCORE){this.score=-Constants.MIN_KILLED_SCORE}};function AbstractSequenceStrategy(a){if(!a){throw new Error("abstract class cannot be initialized!")}this._init()}AbstractSequenceStrategy.DEFAULT_SLIDE_WINDOW_SIZE=10;AbstractSequenceStrategy.prototype=new SequenceStrategy(true);AbstractSequenceStrategy.prototype._init=function(){this._doneProblems=null;this._bucketMananger=null;this._problemList=new MarkableLinkedList();this._slideWindow=null;this._slideWindowPointer=-1;this._slideWindowSize=AbstractSequenceStrategy.DEFAULT_SLIDE_WINDOW_SIZE;this._skipProblems={};var a=new Date();a.setHours(0,0,0,0);this._todayBeginMSec=a.getTime()};AbstractSequenceStrategy.prototype._isTodayNewLearned=function(a){return(a&&a.todayNewLearned)};AbstractSequenceStrategy.prototype._isTodayLearned=function(a){return(a&&a.lastLearnedTime>=this._todayBeginMSec)};AbstractSequenceStrategy.prototype.userActionHint=function(a){if(!a){return}var b=a.actionHintCount;b=(b!=null&&b>0)?b+1:1;a.actionHintCount=b};AbstractSequenceStrategy.prototype.setSlideWindowSize=function(a){if(a>0){this._slideWindowSize=a}};AbstractSequenceStrategy.prototype.setTodayDoneProblems=function(a){this._todayDoneProblems=a};AbstractSequenceStrategy.prototype.getTodayRoadMap=function(){var c=[];var h=this._problemList.getMarkedElement();var a=this._problemList.size();var b=0;for(var f=this._problemList.iterator();f.hasNext();b++){var d=f.next();if(d!=null){c.push(d);try{if(h!=null&&(h==d||(h.equals&&h.equals(d)))){a=b}}catch(g){}}}return{markedPosition:a,list:c}};AbstractSequenceStrategy.prototype.getReviewCount=function(){var a=0;for(var c=this._problemList.iterator();c.hasNext();){var b=c.next();if(b&&b.score>=0&&!this._skipProblems[b.id]){a++}}return a};AbstractSequenceStrategy.prototype.getNewLearningCount=function(){var a=0;for(var c=this._problemList.iterator();c.hasNext();){var b=c.next();if(b&&b.score==Constants.NEW_LEARNING_SCORE&&!this._skipProblems[b.id]){a++}}return a};AbstractSequenceStrategy.prototype.getNewLearningAndReviewCount=function(){var b=0;var a=0;for(var d=this._problemList.iterator();d.hasNext();){var c=d.next();if(c&&c.score==Constants.NEW_LEARNING_SCORE&&!this._skipProblems[c.id]){b++}if(c&&c.score>=0&&!this._skipProblems[c.id]){a++}}return{newLearningCount:b,reviewCount:a}};AbstractSequenceStrategy.prototype._doGetNext=function(d,h,g){var i=[];var b=d;var c=b+h;var f=null;for(var j=-1,e=this._problemList.iterator();e.hasNext();){var a=e.next();if(!a||!a.id){continue}if(this._skipProblems[a.id]){continue}j++;if(j>=b&&j<c){i.push(a);f=a}if(j>=c){break}}if(g){if(f){this._problemList.mark(f,false,5)}else{this._problemList.markTail()}}return i};AbstractSequenceStrategy.prototype._getNextFromSlideWindow=function(g,d,f){var e=d>this._slideWindowSize?d:this._slideWindowSize;this._slideWindow=this._doGetNext(g,e,true);var b=[];if(this._slideWindow==null||this._slideWindow.length==0){return b}var a=this._slideWindow.length;for(var c=0;c<d&&c<a;c++){b.push(this._slideWindow[c])}if(f){}return b};AbstractSequenceStrategy.prototype.getNext=function(b,a){return this._getNextFromSlideWindow(b,a,true)};AbstractSequenceStrategy.prototype.hasNext=function(){var a=this._getNextFromSlideWindow(0,1,false);return a!=null&&a.length&&a.length>0};AbstractSequenceStrategy.prototype.doneCorrect=function(f,d,b){if(!f){return null}if(f.actionHintCount==1&&(!f.actionHintReviewedCount||f.actionHintCount<1)){var i=f.actionHintReviewedCount;i=(i!=null&&i>0)?i+1:1;f.actionHintReviewedCount=i;return this.doneWrong(f,d,b)}f.lastLearnedTime=new Date().getTime();f.deepLearning=false;var e=f.score;var g=this._bucketMananger.getBucket(e);if(g==null){return null}var h=0;if(e<=Constants.NEW_LEARNING_SCORE){h=1;f.todayNewLearned=true}else{h=e+1}f.score=h;f.lastScore=e;this._doneProblems[f.id]=f;if(this._todayDoneProblems){this._todayDoneProblems[f.id]=f}this._problemList.remove(f);g.remove(f);var a=this._bucketMananger.getBucket(h);if(a){a.add(f)}if(h==Constants.NEW_LEARNING_SCORE||(h>=0&&h<=2)){this._problemList.insertAfterMark(f,true)}return f};AbstractSequenceStrategy.prototype.doneWrong=function(f,d,b){if(!f){return null}if(f.actionHintCount==1&&(!f.actionHintReviewedCount||f.actionHintCount<1)){var i=f.actionHintReviewedCount;i=(i!=null&&i>0)?i+1:1;f.actionHintReviewedCount=i}if(f.score<=2){f.lastLearnedTime=new Date().getTime()}f.deepLearning=true;var e=f.score;var g=this._bucketMananger.getBucket(e);if(g==null){return null}var h=0;if(e<=Constants.NEW_LEARNING_SCORE){h=0;f.todayNewLearned=true}else{h=e}f.score=h;f.wrongCount=(f.wrongCount==null?0:f.wrongCount)+1;if(h!=e){var a=this._bucketMananger.getBucket(h);g.remove(f);a.add(f)}this._doneProblems[f.id]=f;if(this._todayDoneProblems){this._todayDoneProblems[f.id]=f}this._problemList.remove(f);this._problemList.insertAfterMark(f,true);return f};AbstractSequenceStrategy.prototype.kill=function(b){if(!b){return}var a=b.score;if(a<=Constants.NEW_LEARNING_SCORE){b.todayNewLearned=true}var c=this._bucketMananger.getBucket(b.score);if(c!=null){c.remove(b)}this._doneProblems[b.id]=b;if(this._todayDoneProblems){this._todayDoneProblems[b.id]=b}this._problemList.remove(b);b.lastLearnedTime=new Date().getTime();b.deepLearning=false;b.lastScore=b.score;b.kill()};AbstractSequenceStrategy.prototype.cancelKill=function(a){if(!a){return}this._problemList.remove(a);a.lastLearnedTime=new Date().getTime();a.lastScore=a.score;a.cancelKill();var b=this._bucketMananger.getBucket(a.score);if(b!=null){b.add(a);this._doneProblems[a.id]=a;if(this._todayDoneProblems){this._todayDoneProblems[a.id]=a}}};AbstractSequenceStrategy.prototype.skip=function(a){if(!a||!a.id){return}this._skipProblems[a.id]=a};AbstractSequenceStrategy.prototype.cancelSkip=function(a){if(!a||!a.id){return}delete this._skipProblems[a.id]};function MarkableLinkedList(){this._mark=null;this._init()}MarkableLinkedList.prototype=new LinkedList();MarkableLinkedList.prototype._init=function(){LinkedList.prototype._init.apply(this,arguments)};MarkableLinkedList.prototype.markTail=function(){if(!this.isEmpty()){this._mark=this._tail.previous}};MarkableLinkedList.prototype.markHead=function(){if(!this.isEmpty()){this._mark=this._head.next}};MarkableLinkedList.prototype.getMarkedElement=function(){if(this._mark==null){return null}return this._mark.element};MarkableLinkedList.prototype.getNextFromMark=function(c,d){var a=[];if(this._mark==null||this._mark==this._head){this._mark=this._head.next}var b=null;for(b=this._mark;b!=null&&b!=this._tail&&a.length<c;b=b.next){a.push(b.element)}if(d){this._mark=b}return a};MarkableLinkedList.prototype.mark=function(g,b,c){var d=-1;var h=-1;var j=0;var a=null;for(var f=this._head.next;f!=this._tail&&f!=null;f=f.next,j++){if(this._equals(g,f.element)){h=j;a=f}if(f==this._mark){d=j}if(h>=0&&(this._mark==null||d>=0)){break}}if(a!=null&&(this._mark==null||b||h>d)){if(c&&c>0){for(var e=0;e<c&&a&&a.next&&a.next!=this._tail;e++){a=a.next}}this._mark=a}};MarkableLinkedList.prototype.insertAfterMark=function(a,e){var d=this._mark==null?this._tail.previous:this._mark;var c=new LinkedList.Node(a);var b=d.next;d.next=c;c.previous=d;c.next=b;b.previous=c;this._listSize++;if(e){this._mark=c}};MarkableLinkedList.prototype.remove=function(a){for(var b=this._head.next;b!=this._tail;b=b.next){if(this._equals(a,b.element)){b.previous.next=b.next;b.next.previous=b.previous;this._listSize--;if(b==this._mark){this._mark=this._mark.previous}return}}};function ArrayBucket(b,a,c){this._roadMap=b;this._doneProblems=a;this._list=c==null||c.length==0?[]:c;this._pnt=0;this._delMap={};this._delCount=0}ArrayBucket.prototype=new Bucket(true,null);ArrayBucket.prototype.next=function(b){if(!this._list||this._pnt>=this._list.length){return null}var a=[];for(;this._pnt<this._list.length&&a.length<b;this._pnt++){var c=this._list[this._pnt];if(c==null||(c!=null&&c.id!=null&&this._delMap[c.id]!=null)){continue}a.push(c)}return a};ArrayBucket.prototype.hasNext=function(){if(this._list==null||this._list.length==0){return false}for(var a=this._pnt;a<this._list.length;a++){var b=this._list[a];if(b!=null&&b.id!=null&&this._delMap[b.id]==null){return true}}return false};ArrayBucket.prototype.size=function(){return this._list.length-this._delCount};ArrayBucket.prototype.rewind=function(){this._pnt=0};ArrayBucket.prototype.remove=function(a){if(a==null||a.id==null){return false}var b=a.id;if(this._delMap[b]){return true}this._delCount++;this._delMap[b]=a;return true};ArrayBucket.prototype.add=function(a){if(a==null||a.id==null){return false}var b=a.id;if(this._delMap[b]){this._delMap[b]=null;this._delCount--}else{this._list.push(a)}return true};function BucketManager(b,a){this._roadMap=b;this._doneProblems=a;this._buckets={}}BucketManager.NEW_LEARNING_BUCKET_ID=Constants.NEW_LEARNING_SCORE;BucketManager.SCORE_MIN_BUCKET_ID=0;BucketManager.SCORE_MAX_BUCKET_ID=9;BucketManager.MIN_SCORE=Constants.NEW_LEARNING_SCORE;BucketManager.MAX_SCORE=Constants.MAX_INT;BucketManager.prototype={build:function(){this._buckets={};if(this._roadMap==null){return}var e={};e[BucketManager.NEW_LEARNING_BUCKET_ID]=[];for(var h=BucketManager.SCORE_MIN_BUCKET_ID;h<=BucketManager.SCORE_MAX_BUCKET_ID;h++){e[h]=[]}var b=this._roadMap.length;var c=Constants.NEW_LEARNING_SCORE;for(var d=0;d<b;d++){var g=this._roadMap[d];var f=this._doneProblems[g.id];if(f==null){f=g;f.score=c;f.lastScore=c}else{if(f.isKilled()){continue}}var h=this.getBucketId(f.score);f.isNewLearning=(h==BucketManager.NEW_LEARNING_BUCKET_ID);var a=e[h];if(a!=null){a.push(f)}}var a=e[BucketManager.SCORE_MAX_BUCKET_ID];a.sort(function(j,i){var k=j.score-i.score;return k!=0?k:(j.id-i.id)});this._buckets[BucketManager.NEW_LEARNING_BUCKET_ID]=new ArrayBucket(this._roadMap,this._doneProblems,e[BucketManager.NEW_LEARNING_BUCKET_ID]);for(var h=BucketManager.SCORE_MIN_BUCKET_ID;h<=BucketManager.SCORE_MAX_BUCKET_ID;h++){this._buckets[h]=new ArrayBucket(this._roadMap,this._doneProblems,e[h])}},buildWithBuckets:function(b){this._buckets={};if(this._roadMap==null){return}for(var d in b){var c=b[d];var a=this.getBucketId(parseInt(d));this._buckets[a]=new ArrayBucket(this._roadMap,this._doneProblems,c)}},getBucket:function(b){if(this._buckets==null){return null}var a=this.getBucketId(b);if(a==null){return null}var c=this._buckets[a];return c},getBucketId:function(a){if(a<=BucketManager.NEW_LEARNING_BUCKET_ID){return BucketManager.NEW_LEARNING_BUCKET_ID}if(a>=BucketManager.SCORE_MIN_BUCKET_ID&&a<=BucketManager.SCORE_MAX_BUCKET_ID){return a}if(a>BucketManager.SCORE_MAX_BUCKET_ID){return BucketManager.SCORE_MAX_BUCKET_ID}return null}};function NewAndReviewSequenceStrategy(e,d,c,b,a){this._init(e,d,c,b,a)}NewAndReviewSequenceStrategy.prototype=new AbstractSequenceStrategy(true);NewAndReviewSequenceStrategy.prototype._init=function(e,d,c,b,a){AbstractSequenceStrategy.prototype._init.apply(this,arguments);this._bucketMananger=e;this._planCount=d;this._roadMap=c;this._doneProblems=b;this._todayDoneProblems=a;this._maxLearningCount=Constants.MAX_INT;this._newLearningCount=0;this._4_9ReviewCount=0;this._reviewStage=false;this._calculateCount();this._buildProblemList()};NewAndReviewSequenceStrategy.REVIEW_RATE=0.45;NewAndReviewSequenceStrategy.prototype._calculateCount=function(){var d=this._bucketMananger.getBucket(Constants.NEW_LEARNING_SCORE);var b=d.size();if(b>0){this._reviewStage=false;this._newLearningCount=this._planCount;this._maxLearningCount=Constants.MAX_INT;this._4_9ReviewCount=Math.min(this._maxLearningCount,Math.floor(this._planCount*NewAndReviewSequenceStrategy.REVIEW_RATE))}else{this._reviewStage=true;this._newLearningCount=0;this._maxLearningCount=this._planCount;this._4_9ReviewCount=this._planCount}var e=0;var h=0;var f=0;var a=this._todayDoneProblems!=null?this._todayDoneProblems:this._doneProblems;if(a!=null){for(var g in a){var c=a[g];if(c==null){continue}if(this._isTodayLearned(c)&&((c.score>=5)||(c.isKilled()&&!this._isTodayNewLearned(c)&&c.score<=-4))){e++}if(this._isTodayLearned(c)&&(c.score>=4||(c.isKilled()&&c.score<=-4))){f++}if(this._isTodayNewLearned(c)&&(c.score>=0||c.isKilled())){h++}}}this._maxLearningCount-=e;this._newLearningCount-=h;if(this._newLearningCount==0&&h>0&&f>=this._4_9ReviewCount){this._4_9ReviewCount=0}else{this._4_9ReviewCount-=e}};NewAndReviewSequenceStrategy.prototype._buildProblemList=function(){this._problemList=new MarkableLinkedList();for(var d=0;d<=3;d++){var e=this._bucketMananger.getBucket(d);e.rewind();for(var b=null;(b=e.nextOne())!=null&&this._problemList.size()<this._maxLearningCount;){if(b==null||b.id<=0){continue}if(this._isTodayNewLearned(b)){continue}this._problemList.add(b)}}for(var d=4,c=0;c<this._4_9ReviewCount&&this._problemList.size()<this._maxLearningCount&&d<=9;d++){var e=this._bucketMananger.getBucket(d);e.rewind();for(var b=null;(b=e.nextOne())!=null&&c<this._4_9ReviewCount&&this._problemList.size()<this._maxLearningCount;){if(b==null||b.id<=0){continue}if(this._isTodayLearned(b)){continue}this._problemList.add(b);c++}}for(var d=0;d<=2;d++){var e=this._bucketMananger.getBucket(d);e.rewind();for(var b=null;(b=e.nextOne())!=null&&(!this._reviewStage||(this._reviewStage&&this._problemList.size()<this._maxLearningCount));){if(b==null||b.id<=0){continue}if(!this._isTodayNewLearned(b)){continue}this._problemList.add(b)}}this._problemList.markTail();var e=this._bucketMananger.getBucket(Constants.NEW_LEARNING_SCORE);e.rewind();for(var a=0,b=null;(b=e.nextOne())!=null&&a<this._newLearningCount;a++){if(b==null||b.id<=0){continue}b.score=Constants.NEW_LEARNING_SCORE;this._problemList.add(b)}};function ReviewMoreSequenceStrategy(d,c,b,a){this._init(d,c,b,a)}ReviewMoreSequenceStrategy.prototype=new AbstractSequenceStrategy(true);ReviewMoreSequenceStrategy.prototype._init=function(d,c,b,a){AbstractSequenceStrategy.prototype._init.apply(this,arguments);this._bucketMananger=d;this._planCount=c;this._roadMap=b;this._doneProblems=a;this._buildProblemList()};ReviewMoreSequenceStrategy.prototype._buildProblemList=function(){this._problemList=new MarkableLinkedList();var h={};var e=0;var d=null;e=3;d=this._bucketMananger.getBucket(e);d.rewind();for(var a=null;(a=d.nextOne())!=null&&this._problemList.size()<this._planCount;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}if(this._isTodayLearned(a)&&a.wrongCount>0&&a.reviewMoreCount==0){this._problemList.add(a);h[a.id]=a}}for(e=4;this._problemList.size()<this._planCount&&e<=9;e++){d=this._bucketMananger.getBucket(e);d.rewind();for(var a=null;(a=d.nextOne())!=null&&this._problemList.size()<this._planCount;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}if(!this._isTodayLearned(a)||a.reviewMoreCount==0){this._problemList.add(a);h[a.id]=a}}}e=3;d=this._bucketMananger.getBucket(e);d.rewind();var l=[];for(var a=null;(a=d.nextOne())!=null;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}if(a.reviewMoreCount!=0){continue}l.push(a)}l.sort(function(o,m){var p=70;var n=100-p;var i=o.wrongCount*p-o.reviewMoreCount*n;var q=m.wrongCount*p-m.reviewMoreCount*n;if(i>q){return -1}else{if(i<q){return 1}}return o.id-m.id});for(var f=0;f<l.length&&this._problemList.size()<this._planCount;f++){var a=l[f];this._problemList.add(a);h[a.id]=a}if(this._problemList.size()>=this._planCount){return}for(e=0;this._problemList.size()<this._planCount&&e<=9;e++){d=this._bucketMananger.getBucket(e);d.rewind();for(var a=null;(a=d.nextOne())!=null&&this._problemList.size()<this._planCount;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}if(!this._isTodayLearned(a)&&a.reviewMoreCount==0){this._problemList.add(a);h[a.id]=a}}}if(this._problemList.size()>=this._planCount){return}var g=[];var j=this._planCount-this._problemList.size();for(e=0;g.length<j&&e<=9;e++){d=this._bucketMananger.getBucket(e);d.rewind();for(var a=null;(a=d.nextOne())!=null&&g.length<j;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}var c=Math.random();if(c<0.3){continue}g.push(a);h[a.id]=a}}for(e=0;g.length<j&&e<=9;e++){d=this._bucketMananger.getBucket(e);d.rewind();for(var a=null;(a=d.nextOne())!=null&&g.length<j;){if(a==null||a.id<=0){continue}if(h[a.id]){continue}g.push(a);h[a.id]=a}}for(var f=0;f<g.length;f++){var b=parseInt(Math.random()*g.length);var k=g[f];g[f]=g[b];g[b]=k}for(var f=0;f<g.length;f++){var a=g[f];this._problemList.add(a)}};ReviewMoreSequenceStrategy.prototype.doneCorrect=function(f,d,b){if(!f){return null}if(f.actionHintCount==1&&(!f.actionHintReviewedCount||f.actionHintCount<1)){var i=f.actionHintReviewedCount;i=(i!=null&&i>0)?i+1:1;f.actionHintReviewedCount=i;return this.doneWrong(f,d,b)}f.lastLearnedTime=new Date().getTime();f.deepLearning=false;var e=f.score;var g=this._bucketMananger.getBucket(e);if(g==null){return null}var h=0;if(e>=4){h=e+1}else{h=e}f.score=h;f.lastScore=e;f.reviewMoreCount=(f.reviewMoreCount==null?0:f.reviewMoreCount)+1;this._doneProblems[f.id]=f;if(this._todayDoneProblems){this._todayDoneProblems[f.id]=f}this._problemList.remove(f);g.remove(f);var a=this._bucketMananger.getBucket(h);if(a){a.add(f)}return f};ReviewMoreSequenceStrategy.prototype.doneWrong=function(d,b,a){if(!d){return null}if(d.actionHintCount==1&&(!d.actionHintReviewedCount||d.actionHintCount<1)){var e=d.actionHintReviewedCount;e=(e!=null&&e>0)?e+1:1;d.actionHintReviewedCount=e}d.deepLearning=true;d.wrongCount=(d.wrongCount==null?0:d.wrongCount)+1;this._doneProblems[d.id]=d;if(this._todayDoneProblems){this._todayDoneProblems[d.id]=d}this._problemList.remove(d);this._problemList.insertAfterMark(d,true);return d};function MultiMediaSequenceStrategy(f,e,c,b,d,a){this._init(f,e,c,b,d,a)}MultiMediaSequenceStrategy.prototype=new AbstractSequenceStrategy(true);MultiMediaSequenceStrategy.prototype._init=function(f,e,c,b,d,a){AbstractSequenceStrategy.prototype._init.apply(this,arguments);this._bucketMananger=f;this._planCount=e;this._roadMap=c;this._doneProblems=b;this._learnedList=d;this._skippedList=a;this._buildProblemList()};MultiMediaSequenceStrategy.prototype._buildProblemList=function(){this._problemList=new MarkableLinkedList();var b={};var c=0;var e=null;if(this._doneProblems){for(var d in this._doneProblems){var a=this._doneProblems[d];if(a==null||a.id<=0){continue}if(b[a.id]){continue}if(a.deepLearning){this._problemList.add(a);b[a.id]=a}if(this._problemList.size()>=this._planCount){break}}}for(c=0;this._problemList.size()<this._planCount&&c<=9;c++){e=this._bucketMananger.getBucket(c);e.rewind();for(var a=null;(a=e.nextOne())!=null&&this._problemList.size()<this._planCount;){if(a==null||a.id<=0){continue}if(b[a.id]){continue}if(this._learnedList!=null&&this._learnedList[a.id]!=null){continue}if(this._skippedList!=null&&this._skippedList[a.id]!=null){continue}this._problemList.add(a);b[a.id]=a}}if(this._problemList.size()>=this._planCount){return}for(c=0;this._problemList.size()<this._planCount&&c<=9;c++){e=this._bucketMananger.getBucket(c);e.rewind();for(var a=null;(a=e.nextOne())!=null&&this._problemList.size()<this._planCount;){if(a==null||a.id<=0){continue}if(b[a.id]){continue}this._problemList.add(a);b[a.id]=a}}};MultiMediaSequenceStrategy.prototype.doneCorrect=function(c,b,a){if(!c){return null}c.deepLearning=false;if(this._learnedList==null){this._learnedList={}}var d=this._learnedList[c.id];this._learnedList[c.id]=d==null?1:d+1;c.reviewMoreCount=(c.reviewMoreCount==null?0:c.reviewMoreCount)+1;this._doneProblems[c.id]=c;if(this._todayDoneProblems){this._todayDoneProblems[c.id]=c}this._problemList.remove(c);return c};MultiMediaSequenceStrategy.prototype.doneWrong=function(c,b,a){if(!c){return null}c.deepLearning=true;if(this._learnedList==null){this._learnedList={}}var d=this._learnedList[c.id];this._learnedList[c.id]=d==null?1:d+1;c.wrongCount=(c.wrongCount==null?0:c.wrongCount)+1;c.reviewMoreCount=(c.reviewMoreCount==null?0:c.reviewMoreCount)+1;this._doneProblems[c.id]=c;if(this._todayDoneProblems){this._todayDoneProblems[c.id]=c}this._problemList.remove(c);this._problemList.insertAfterMark(c,true);return c};